@model IEnumerable<retailCLDVportal.Models.OrderEntity>
@{
    ViewData["Title"] = "Orders";
    string Money(long cents, string? cur) {
        var v = cents / 100m;
        var prefix = (cur ?? "ZAR") == "ZAR" ? "R " : "";
        return prefix + v.ToString("0.00");
    }
}
<div class="page-head d-flex justify-content-between align-items-start">
    <div>
        <h1>Orders</h1>
        <p class="page-sub">All orders</p>
    </div>
    <a class="btn btn-primary" asp-action="Create"><i class="bi bi-plus-lg me-1"></i> New Order</a>
</div>

@if (TempData["Message"] is string ok) { <div class="alert alert-success mt-3">@ok</div> }
@if (TempData["Error"]   is string err){ <div class="alert alert-danger mt-3">@err</div> }

<div class="glass-card p-3">
    <div class="table-responsive">
        <table class="table table-neon table-compact align-middle">
            <thead>
                <tr>
                    <th>Order #</th>
                    <th>Customer</th>
                    <th>Product</th>
                    <th>Qty</th>
                    <th>Unit</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Created (UTC)</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var o in Model)
            {
                <tr>
                    <td>@o.OrderNo</td>
                    <td>@o.CustomerName</td>
                    <td>@o.ProductName</td>
                    <td>@o.Quantity</td>
                    <td>@Money(o.UnitPriceCents, o.Currency)</td>
                    <td class="fw-bold">@Money(o.TotalCents, o.Currency)</td>
                    <td>@o.Status</td>
                    <td>@o.CreatedUtc.ToString("yyyy-MM-dd HH:mm")</td>
                    <td class="text-end">
                        <div class="btn-group btn-group-sm">
                            
                            <a class="btn btn-outline-light"
                            asp-action="Details"
                            asp-route-pk="@o.PartitionKey"
                            asp-route-rk="@o.RowKey">Details</a>

                            <a class="btn btn-outline-light"
                            asp-action="Edit"
                            asp-route-pk="@o.PartitionKey"
                            asp-route-rk="@o.RowKey">Edit</a>

                            <form asp-action="Delete" method="post" class="d-inline"
                                  asp-route-pk="@o.PartitionKey" asp-route-rk="@o.RowKey"
                                  onsubmit="return confirm('Delete order @o.OrderNo?');">
                                <button class="btn btn-outline-danger" type="submit">Delete</button>
                            </form>
                        </div>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
</div>
